<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart News</title>
    <link rel="stylesheet" href="../static/css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=The+Seasons&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>  
    <div class="flex min-h-screen">
        <!-- Sidebar -->
        <div id="sidebar" class="sidebar">
            <button class="close-button" onclick="toggleSidebar()">
                <i data-lucide="x"></i>
            </button>
            
            <nav class="sidebar-nav">
                <div class="nav-links">
                    <a href="index.html" class="nav-link">
                        <i class="a" data-lucide="home"></i>
                        Home
                    </a>
                    <a href="aboutus.html" class="nav-link">
                        <i class="a" data-lucide="info"></i>
                        About Us
                    </a>
                    <div class="nav-link">
                        <i class="a" data-lucide="menu"></i>
                        Categories
                        <div class="dropdown-content">
                            <div class="domain-section">
                                <h3>Domain</h3>
                                <select id="domainSelect">
                                    <option value="business">Business</option>
                                    <option value="technology">Politics</option>
                                    <option value="sports">Sports</option>
                                    <option value="entertainment">Technology</option>
                                    <option value="entertainment">Startups</option>
                                    <option value="entertainment">Science</option>
                                    <option value="entertainment">Travel</option>
                                    <option value="entertainment">Fashion</option>
                                    <option value="entertainment">Entertainment</option>
                                </select>
                            </div>
                            <div class="country-section">
                                <h3>Country</h3>
                                <select id="countrySelect">
                                    <option value="in">India</option>
                                    <option value="ir">International</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <a href="weather.html" class="nav-link">
                        <i class="a" data-lucide="cloud"></i>
                        Weather
                    </a>
                    <a href="#" class="nav-link">
                        <i class="a" data-lucide="history"></i>
                        Historical News
                    </a>
                    <a href="favourites.html" class="nav-link">
                        <i class="a" data-lucide="heart"></i>
                        Favourites
                    </a>
                    <div href="#" class="nav-link" id="google_translate_element">
                        <i class="a" data-lucide="languages"></i>
                        Language
                    </div>
                </div>
            </nav>
        </div>

        <div id="main-content" class="main-content">
            <header class="header">
                <div class="header-container">
                    <button class="menu-button" onclick="toggleSidebar()">
                        <i class="m" data-lucide="menu"></i>
                    </button>
                    <div onclick="reload()" class="project-name">
                        <span class="large-letter">S</span>mart <span class="large-letter">N</span>ews
                    </div>
                    <div class="login-icon"><a href="login.html"><img src="../static/css/images/icons8-login-50.png" alt="login icon"></a></div>
                </div>
            </header>
    
            <!-- Search Bar -->
            <div class="search-bar">
                <input type="text" id="search-text" class="news-input" placeholder="Search for news..."> 
                <button id="search-button" class="search-button">Search</button>
            </div>

            <!-- News containers portion -->
            <main>
                <div class="cards-container container flex" id="cards-container"></div>
            </main>

            <!-- News Card Template -->
            <template id="template-news-card">
                <div class="news-card animated">
                    <div class="news-image">
                        <img src="https://via.placeholder.com/400x200" alt="news-image" id="news-img">
                    </div>
                    <div class="card-content">
                        <h3 id="news-title" class="news-title">This is title</h3>
                        <h6 id="news-source" class="news-source">End Gadget â€¢ 31/1/2025</h6>
                        <p id="news-desc" class="news-desc">Lorem ipsum dolor sit amet consectetur.</p>
                        <a id="news-url" class="read-more-btn" href="#" target="_blank">Read More</a>
                        <div class="news-actions">
                            <button class="action-btn like-btn"><i class="fas fa-heart"></i></button>
                            <button class="action-btn share-btn"><i class="fas fa-share"></i></button>
                            <button class="action-btn summarize-btn"><i class="fas fa-file-alt"></i></button>
                        </div>
                        <div class="summary-content sliding-window" style="display: none;">
                            <div class="summary-header">
                                <h3 class="summary-heading">Summary</h3>
                                <button class="close-summary-btn">&times;</button>
                            </div>
                            <p class="news-summary"></p>
                        </div>
                    </div>
                </div>
            </template>

            <div class="scroll-to-top" id="scrollToTop">
                <i class="fas fa-arrow-up"></i>
            </div>

            <div class="chatbot-button">
                <i class="fas fa-robot"></i>
            </div>

            <div class="chatbot-popup">
                <span class="close-popup">&times;</span>
                <p>Our chatbot is currently under development. We're working hard to bring you an amazing conversational experience soon! ðŸš€</p>
            </div>
        </div>
    </div>

    <footer>
        <p>&copy; 2025 Smart News. All rights reserved.</p>
    </footer>

    <script src="../static/css/script.js"></script>
    
    <script type="text/javascript">
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({
                pageLanguage: 'en',
                includedLanguages: 'en,hi,mr',
                layout: google.translate.TranslateElement.InlineLayout.SIMPLE
            }, 'google_translate_element');
        }
    </script>
    <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>    
    
    <script>
        // Function to animate the display of the summary text
        function animateSummary(element, text) {
            element.innerHTML = '';
            let index = 0;
            const interval = setInterval(() => {
                if (index < text.length) {
                    element.innerHTML += text[index];
                    index++;
                } else {
                    clearInterval(interval);
                }
            }, 30);
        }

        // Add event listener when the DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Event delegation for handling clicks
            document.addEventListener('click', async function(event) {
                const target = event.target;

                // Handle summarize button click
                if (target.closest('.summarize-btn')) {
                    const card = target.closest('.news-card');
                    if (!card) return;

                    const summaryContainer = card.querySelector('.summary-content');
                    const summaryText = card.querySelector('.news-summary');
                    const newsUrl = card.querySelector('#news-url').href;
                    const newsDesc = card.querySelector('#news-desc');

                    if (!summaryContainer || !summaryText || !newsDesc) return;

                    if (!summaryContainer.classList.contains('show')) {
                        // Show the sliding window instantly
                        summaryContainer.style.display = 'block';
                        setTimeout(() => {
                            summaryContainer.classList.add('show');
                        }, 10);

                        if (!summaryText.innerText.trim()) {
                            // Show loading animation
                            summaryText.innerHTML = '<div class="loading-dots"><div></div><div></div><div></div></div>';
                            
                            try {
                                // Send the URL directly to the summarize endpoint
                                const response = await fetch('http://127.0.0.1:5000/summarize', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json'
                                    },
                                    body: JSON.stringify({ url: newsUrl })
                                });

                                if (!response.ok) {
                                    throw new Error(`HTTP error! Status: ${response.status}`);
                                }

                                const data = await response.json();
                                
                                if (data.error) {
                                    throw new Error(data.error);
                                }

                                animateSummary(summaryText, data.summary);
                            } catch (error) {
                                console.error('Error:', error);
                                summaryText.innerText = 'Sorry, we couldn\'t generate a summary at this time. Please try again later.';
                            }
                        }

                        newsDesc.style.display = 'none';
                    }
                }

                // Handle close summary button click
                if (target.classList.contains('close-summary-btn')) {
                    const card = target.closest('.news-card');
                    if (!card) return;

                    const summaryContainer = card.querySelector('.summary-content');
                    const newsDesc = card.querySelector('#news-desc');

                    if (!summaryContainer || !newsDesc) return;

                    summaryContainer.classList.remove('show');
                    setTimeout(() => {
                        summaryContainer.style.display = 'none';
                        newsDesc.style.display = 'block';
                    }, 300);
                }
            });
        });
    </script>
</body>
</html>