<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart News</title>
    <link rel="stylesheet" href="../static/css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=The+Seasons&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"> 
    <script src="https://cdn.jsdelivr.net/npm/lucide@latest/dist/umd/lucide.min.js"></script>
</head>
<body>  
    <div class="flex min-h-screen">
        <!-- Sidebar -->
        <div id="sidebar" class="sidebar">
            <button class="close-button" onclick="toggleSidebar()">
                <i data-lucide="x"></i>
            </button>
            
            <nav class="sidebar-nav">
                <div class="nav-links">
                    <a href="index.html" class="nav-link">
                        <i data-lucide="home"></i>
                        Home
                    </a>
                    <a href="aboutus.html" class="nav-link">
                        <i data-lucide="info"></i>
                        About Us
                    </a>
                    <div class="nav-link">
                        <i data-lucide="menu"></i>
                        Categories
                        <div class="dropdown-content">
                            <div class="domain-section">
                                <h3>Domain</h3>
                                <select id="domainSelect">
                                    <option value="business">Business</option>
                                    <option value="politics">Politics</option>
                                    <option value="sports">Sports</option>
                                    <option value="technology">Technology</option>
                                    <option value="startups">Startups</option>
                                    <option value="science">Science</option>
                                    <option value="travel">Travel</option>
                                    <option value="fashion">Fashion</option>
                                    <option value="entertainment">Entertainment</option>
                                </select>
                            </div>
                            <div class="country-section">
                                <h3>Country</h3>
                                <select id="countrySelect">
                                    <option value="in">India</option>
                                    <option value="ir">International</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <a href="weather.html" class="nav-link">
                        <i data-lucide="cloud"></i>
                        Weather
                    </a>
                    <a href="#" class="nav-link">
                        <i data-lucide="history"></i>
                        Historical News
                    </a>
                    <a href="favourites.html" class="nav-link">
                        <i data-lucide="heart"></i>
                        Profile/Favourites
                    </a>
                    <div href="#" class="nav-link" id="google_translate_element">
                        <i data-lucide="languages"></i>
                        Language
                    </div>
                </div>
            </nav>
        </div>

        <div id="main-content" class="main-content">
            <header class="header">
                <div class="header-container">
                    <button class="menu-button" onclick="toggleSidebar()">
                        <i data-lucide="menu"></i>
                    </button>
                    <div onclick="reload()" class="project-name">
                        <span class="large-letter">S</span>mart <span class="large-letter">N</span>ews
                    </div>
                    <div id="profile-section" class="profile-container">
                        <div id="profile-icon" class="profile-icon"></div>
                        <span id="profile-name" class="profile-name"></span>
                        <div id="dropdown" class="dropdown" style="display: none;">
                            <button id="logout">Logout</button>
                        </div>
                    </div>
                    <div id="login-icon"   class="login-icon"><a href="login.html"><img src="../static/css/images/icons8-login-50.png" alt="login icon"></a></div>
                </div>
            </header>
    
            <!-- Search Bar -->
            <div class="search-bar">
                <input type="text" id="search-text" class="news-input" placeholder="Search for news..."> 
                <button id="search-button" class="search-button">Search</button>
            </div>

            <!-- News containers portion -->
            <main>
                <div class="cards-container container flex" id="cards-container"></div>
            </main>

            <!-- News Card Template -->
            <template id="template-news-card">
                <div class="news-card animated">
                    <div class="news-image">
                        <img src="https://via.placeholder.com/400x200" alt="news-image" id="news-img">
                    </div>
                    <div class="card-content">
                        <h3 id="news-title" class="news-title">This is title</h3>
                        <h6 id="news-source" class="news-source">End Gadget â€¢ 31/1/2025</h6>
                        <p id="news-desc" class="news-desc">Lorem ipsum dolor sit amet consectetur.</p>
                        <a id="news-url" class="read-more-btn" href="#" target="_blank">Read More</a>
                        <div class="news-actions">
                            <button class="action-btn like-btn" data-tooltip="Favourites"><i class="fas fa-heart"></i></button>
                            <button class="action-btn share-btn" data-tooltip="Share"><i class="fas fa-share"></i></button>
                            <button class="action-btn summarize-btn" data-tooltip="Summary"><i class="fas fa-file-alt"></i></button>
                        </div>
                        <div class="summary-content sliding-window" style="display: none;">
                            <div class="summary-header">
                                <button class="voice-btn" data-tooltip="Voice"><i class="fas fa-volume-up"></i></button>
                                <h3 class="summary-heading">Summary</h3>
                                <button class="close-summary-btn" data-tooltip="Close">&times;</button>
                            </div>
                            <p class="news-summary"></p>
                            <!-- Updated Need Help Button -->
                            <button class="help-btn round-help-btn" data-tooltip="Need Help" onclick="window.open('bot.html', '_blank')" style="display: none;">
                                <i class="fas fa-question-circle"></i> Need Help
                            </button>
                        </div>
                    </div>
                </div>
            </template>

            <div class="scroll-to-top" id="scrollToTop">
                <i class="fas fa-arrow-up"></i>
            </div>

            <div class="chatbot-button" id="chatbotButton">
                <i class="fas fa-robot"></i>
            </div>

    <!-- Initialize Lucide icons -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();
        });
    </script>

    <script src="../static/css/script.js"></script>
    
    <script type="text/javascript">
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({
                pageLanguage: 'en',
                includedLanguages: 'en,hi,mr',
                layout: google.translate.TranslateElement.InlineLayout.SIMPLE
            }, 'google_translate_element');
        }
    </script>
    <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>    
    
    <script>
        // Function to animate the display of the summary text
        function animateSummary(element, text) {
            element.innerHTML = '';
            let index = 0;
            const interval = setInterval(() => {
                if (index < text.length) {
                    element.innerHTML += text[index];
                    index++;
                } else {
                    clearInterval(interval);
                    const helpButton = element.closest('.summary-content').querySelector('.help-btn');
                    helpButton.style.display = 'flex'; // Make the button visible
                }
            }, 30);
        }
    
        // Function to speak the summary text with an Indian accent
        function speakSummary(text, lang = 'hi-IN') {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = lang;
    
            // Find an Indian voice
            const voices = speechSynthesis.getVoices();
            const indianVoice = voices.find(voice => voice.lang === 'hi-IN' || voice.lang === 'en-IN');
    
            if (indianVoice) {
                utterance.voice = indianVoice; // Set the Indian voice
            } else {
                console.warn('Indian voice not found. Using default voice.');
            }
    
            return utterance;
        }
    
        // Add event listener when the DOM is loaded
        document.addEventListener('DOMContentLoaded', function () {
            let currentUtterance = null;
    
            // Event delegation for handling clicks
            document.addEventListener('click', async function (event) {
                const target = event.target;
    
                // Handle summarize button click
                if (target.closest('.summarize-btn')) {
                    const card = target.closest('.news-card');
                    if (!card) return;
    
                    const summaryContainer = card.querySelector('.summary-content');
                    const summaryText = card.querySelector('.news-summary');
                    const newsUrl = card.querySelector('#news-url').href;
                    const newsDesc = card.querySelector('#news-desc');
    
                    if (!summaryContainer || !summaryText || !newsDesc) return;
    
                    if (!summaryContainer.classList.contains('show')) {
                        // Show the sliding window instantly
                        summaryContainer.style.display = 'block';
                        setTimeout(() => {
                            summaryContainer.classList.add('show');
                        }, 10);
    
                        if (!summaryText.innerText.trim()) {
                            // Show loading animation
                            summaryText.innerHTML = '<div class="loading-dots"><div></div><div></div><div></div></div>';
                            
                            try {
                                // Send the URL directly to the summarize endpoint
                                const response = await fetch('http://127.0.0.1:5001/summarize', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json'
                                    },
                                    body: JSON.stringify({ url: newsUrl })
                                });
    
                                if (!response.ok) {
                                    throw new Error(`HTTP error! Status: ${response.status}`);
                                }
    
                                const data = await response.json();
                                
                                if (data.error) {
                                    throw new Error(data.error);
                                }
    
                                animateSummary(summaryText, data.summary);
                            } catch (error) {
                                console.error('Error:', error);
                                summaryText.innerText = 'Sorry, we couldn\'t generate a summary at this time. Please try again later.';
                            }
                        }
    
                        newsDesc.style.display = 'none';
                    }
                }
    
                // Handle close summary button click
                if (target.classList.contains('close-summary-btn')) {
                    const card = target.closest('.news-card');
                    if (!card) return;
    
                    const summaryContainer = card.querySelector('.summary-content');
                    const newsDesc = card.querySelector('#news-desc');
    
                    if (!summaryContainer || !newsDesc) return;
    
                    // Stop any ongoing speech
                    if (speechSynthesis.speaking) {
                        speechSynthesis.cancel();
                    }
    
                    // Close the summary window
                    summaryContainer.classList.remove('show');
                    setTimeout(() => {
                        summaryContainer.style.display = 'none';
                        newsDesc.style.display = 'block';
                    }, 300);
                }
    
                // Handle voice button click
                if (target.closest('.voice-btn')) {
                    const card = target.closest('.news-card');
                    if (!card) return;
    
                    const summaryText = card.querySelector('.news-summary').innerText;
                    const lang = document.documentElement.lang || 'hi-IN'; // Use Indian English or Hindi
                    const voiceBtn = card.querySelector('.voice-btn');
    
                    // Stop any ongoing speech
                    if (speechSynthesis.speaking) {
                        speechSynthesis.cancel();
                    }
    
                    // Start reading the summary with an Indian accent
                    currentUtterance = speakSummary(summaryText, lang);
                    speechSynthesis.speak(currentUtterance);
    
                    // Change icon to indicate active reading
                    voiceBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
                }
            });
    
            // Handle when speech ends
            speechSynthesis.onend = () => {
                const voiceBtn = document.querySelector('.voice-btn');
                if (voiceBtn) {
                    voiceBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
                }
            };
    
            // Ensure voices are loaded before using them
            speechSynthesis.onvoiceschanged = () => {
                console.log('Voices loaded:', speechSynthesis.getVoices());
            };
        });

        // Chatbot button click functionality
        document.getElementById('chatbotButton').addEventListener('click', function() {
            window.open('bot.html', '_blank'); // Open bot.html in a new tab
        });
    </script>

<footer>
    <p>&copy; 2025 Smart News. All rights reserved.</p>
</footer>

</body>
</html>